"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useZupassPopupSetup = exports.useZupassPopupMessages = void 0;
const react_1 = require("react");
const core_1 = require("./core");
/**
 * React hook that listens for PCDs and PendingPCDs from a Zupass popup window.
 * A thin wrapper around {@link receiveZupassPopupMessage}.
 */
function useZupassPopupMessages() {
    const [pcdStr, setPCDStr] = (0, react_1.useState)("");
    const [pendingPCDStr, setPendingPCDStr] = (0, react_1.useState)("");
    // Listen for PCDs coming back from the Zupass popup
    (0, react_1.useEffect)(() => {
        const abortReceiveMessage = new AbortController();
        (0, core_1.receiveZupassPopupMessage)(abortReceiveMessage.signal).then((result) => {
            if (result.type === "pcd") {
                setPCDStr(result.pcdStr);
            }
            else if (result.type === "pendingPcd") {
                setPendingPCDStr(result.pendingPcdStr);
            }
        });
        return () => {
            // If the hook is unmounted, signal that the message handlers can detach
            // by aborting.
            abortReceiveMessage.abort();
        };
    }, []);
    return [pcdStr, pendingPCDStr];
}
exports.useZupassPopupMessages = useZupassPopupMessages;
/**
 * Call this hook on a dedicated /popup page in your app to integrate your
 * app with the Zupass proving/auth popup flow.
 *
 * See {@link zupassPopupSetup} for further details.
 */
function useZupassPopupSetup() {
    // Usually this page redirects immediately. If not, show an error.
    const [error, setError] = (0, react_1.useState)("");
    (0, react_1.useEffect)(() => {
        (0, core_1.zupassPopupSetup)().then((maybeErrorMessage) => {
            if (maybeErrorMessage) {
                setError(maybeErrorMessage);
            }
        });
    }, []);
    return error;
}
exports.useZupassPopupSetup = useZupassPopupSetup;
